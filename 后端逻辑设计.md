# 后端逻辑设计

## 分层

- 后项目端设计分为四个层级，分别为响应层、作用层、数据层、算子层。
  - 响应层负责接收前端的请求，调用作用层获取结果，最终向前端返回结果。
  - 作用层负责实现功能逻辑，维护数据层提供的文档对象，最终向响应层返回结果。
  - 数据层负责提供文档对象和其他块对象和各对象的维护方法。
  - 算子层负责提供可供算子块对象调用的算法。
- 项目整体需要实现的功能：
  - I/O类
    - 上传数据

    - 打开文档
  
    - 保存文档
  
    - 导出文档、数据或图片
  
  - 编辑类
    - 块内编辑
      - 文本块编辑
      - 数据块编辑（暂不做）
      - 图像设置调整（暂不做）
      - 算子块参数编辑
    - 块编辑
      - 增加块
      - 删除块
      - 排列块
  
  - 界面类
    - 打开主界面
    - 图像全屏预览（暂不做）
    - 数据全屏预览（暂不做）
  
  - 运行类
    - 算子块运行
  

## 接口层

### 概述

- 接口层的作用是作为前端访问的接口，处理请求的URL信息，调用业务层完成业务逻辑。

### API设置

### IO类

- 上传数据：POST(/data)
  - 会以JSON格式向前端返回数据的元信息

- 打开文档：POST(/docu-file?path = ...)
  - path填写文档文件的目录地址
  - 会以JSON向前端返回文档的元信息和结构信息用以恢复界面

- 保存文档：GET(/docu-file?path = ...)
  - path填写保存文档文件的目的目录地址
  - 会向前端返回是否保存成功的标志信息

- 导出文档：GET(/docu-output?format = ...&path = ...)
  - format填写文档导出的格式，当前只做PDF导出
  - path填写文档导出目录地址
  - 会向前端返回是否导出成功的标志信息

- 导出数据：GET(/data?id = ...&format= ...&path = ...)
  - id填写块的索引
  - format填写导出格式，当前只做CSV格式
  - path填写导出目的目录地址
  - 会向前端返回是否导出成功的标志信息

- 导出图片：GET(/chart?id = ...&format = ...&path = ...)
  - id填写块的索引
  - format填写导出格式
  - path填写导出目的目录地址
  - 会向前端返回是否导出成功的标志信息


### 编辑类

- 块内编辑：PATCH(/cell?class = ...&id = ...)
  - class填写被编辑块的类型
  - id填写被编辑块的编号
  - 具体编辑内容通过JSON传递到后端
  - 会向前端返回是否编辑成功的标志信息
- 块编辑：PATCH(/docu?action = ...&class = ...&id = ...(&op-class))
  - action填写要执行的操作，增 或 删 或 改变排序
  - id填写块编号
  - op-class增添算子块时，需要填写算子块类型
  - 会向前端返回是否编辑成功的标志信息

### 界面类

- 打开主界面：GET(/)
  - 会向前端渲染主界面


### 运行类

- 算子块运行：POST(/operator?id=...)
  - id填写算子块编号
  - 会以JSON形式向前端返回运行结果和块添加方式
  - 前端依照信息在编辑区添加块**（这里后端已经生成块，前端添加到编辑区就行，不需要再向后端发送添加块的请求）**

## 业务层

- 

## 数据层

### 文档对象

- 属性
  - 文档元信息
  - 编辑区引用列表
  - 块对象池

- 方法
  - 编辑区内块的增、删、调序
  - 块对象池内块的增、删、查
  - 文档保存为docu文件
  - 读取docu文件
  - 导出文档为PDF或HTML

### 算子块对象

- 属性
  - 算子块对象ID
  - 算子类型
  - 参数字典
- 方法
  - 调用算子得到结果并返回
  - 参数修改

### 数据块对象

- 属性
  - 数据块对象ID
  - 数据元信息字典
  - 数据文件源目录
  - 数据信息DataFrame
- 方法
  - 数据文件导入导出
  - 数据信息修改
  - 数据查询

### 图像块对象

- 属性
  - 图像块对象ID
  - 图像元信息
  - 图像对象
- 方法
  - 生成plt对象
  - 生成图像矩阵数据
  - 导出图像文件
  - 修改图像设置（元信息）

### 文本块对象

- 属性
  - 文本块对象ID
  - 文本内容
- 方法
  - 返回文本信息
  - 文本信息更新
  - 文本文件导出

## 算子层

- 做成一个库，每个算子用一个模块实现。
- 做一个元模块，提供通过算子名调用对应算子的功能。

